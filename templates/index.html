<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>skillbridge.AI – Your AI-Powered Career Companion</title>
    <style>
        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #13182e;
            --bg-tertiary: #1a1f3a;
            --bg-card: rgba(26, 31, 58, 0.6);
            --accent-primary: #5b8cff;
            --accent-secondary: #7c4dff;
            --accent-success: #18c79c;
            --accent-warning: #ffb020;
            --accent-error: #ff6b6b;
            --text-primary: #e7ecff;
            --text-secondary: #a6b0cf;
            --text-muted: #6b7280;
            --border-color: rgba(91, 140, 255, 0.15);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.5);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Inter', 'Helvetica Neue', Arial, sans-serif;
            background: radial-gradient(ellipse at top left, rgba(91, 140, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(ellipse at bottom right, rgba(124, 77, 255, 0.1) 0%, transparent 50%),
                        var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            padding: 24px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Navbar */
        .navbar {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 16px 24px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-md);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .brand-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(91, 140, 255, 0.3);
        }
        
        .brand-logo svg {
            width: 24px;
            height: 24px;
        }

        .brand-text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .badge {
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, rgba(91, 140, 255, 0.08) 0%, rgba(124, 77, 255, 0.08) 100%);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 64px 48px;
            margin-bottom: 32px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(91, 140, 255, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
        }

        .hero-title {
            font-size: 48px;
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .hero-description {
            font-size: 18px;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 48px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin-top: 48px;
        }

        .hero-feature {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 32px 24px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .hero-feature:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-primary);
        }

        .hero-feature-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .hero-feature-icon svg {
            width: 32px;
            height: 32px;
            filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));
        }

        /* Skill Analysis - Blue/Purple gradient */
        .hero-feature:nth-child(1) .hero-feature-icon {
            background: linear-gradient(135deg, #5b8cff 0%, #7c4dff 100%);
        }

        /* Course Recommendations - Teal/Green gradient */
        .hero-feature:nth-child(2) .hero-feature-icon {
            background: linear-gradient(135deg, #18c79c 0%, #10b981 100%);
        }

        /* Project Ideas - Orange/Red gradient */
        .hero-feature:nth-child(3) .hero-feature-icon {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
        }

        /* Gap Analysis - Pink/Purple gradient */
        .hero-feature:nth-child(4) .hero-feature-icon {
            background: linear-gradient(135deg, #ec4899 0%, #a855f7 100%);
        }

        .hero-feature:hover .hero-feature-icon {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .hero-feature-icon svg path {
            fill: white;
            opacity: 1;
        }

        .hero-feature-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .tab-button {
            flex: 1;
            padding: 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: rgba(91, 140, 255, 0.05);
            color: var(--accent-primary);
        }

        .tab-button.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 12px rgba(91, 140, 255, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Card Component */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            margin-bottom: 24px;
        }

        .card-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .card-body {
            padding: 24px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        input[type="file"] {
            width: 100%;
            padding: 14px;
            background: var(--bg-tertiary);
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="file"]:hover {
            border-color: var(--accent-primary);
            background: rgba(91, 140, 255, 0.05);
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(91, 140, 255, 0.1);
        }

        button[type="submit"] {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: var(--radius-md);
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(91, 140, 255, 0.3);
        }

        button[type="submit"]:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(91, 140, 255, 0.4);
        }

        button[type="submit"]:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Results Section */
        .result-area {
            margin-top: 0;
        }
        
        /* Reduce top padding for result area in cards */
        .card-body .result-area {
            padding-top: 0;
            margin-top: 0;
        }

        .result-area pre {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 15px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.5;
            max-height: 600px;
            overflow-y: auto;
        }

        /* Alert Styles */
        .alert {
            padding: 16px 20px;
            border-radius: var(--radius-md);
            border: 1px solid;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert svg {
            flex-shrink: 0;
        }

        .alert-success {
            background: rgba(24, 199, 156, 0.1);
            border-color: rgba(24, 199, 156, 0.3);
            color: var(--accent-success);
        }

        .alert-error {
            background: rgba(255, 107, 107, 0.1);
            border-color: rgba(255, 107, 107, 0.3);
            color: var(--accent-error);
        }

        .alert-warning {
            background: rgba(251, 191, 36, 0.15);
            border: 2px solid rgba(251, 191, 36, 0.4);
            color: #fbbf24;
            padding: 20px 24px;
            border-radius: var(--radius-md);
            margin-bottom: 24px;
            font-size: 15px;
            font-weight: 600;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.1);
        }

        .alert-warning-icon {
            font-size: 24px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .alert-warning-icon svg {
            width: 24px;
            height: 24px;
        }

        .alert-warning-content {
            flex: 1;
            line-height: 1.6;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
        }

        .metric-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Skills Section */
        .skills-section {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 20px;
        }

        .skills-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 12px;
            border-radius: var(--radius-sm);
            transition: background 0.2s;
        }

        .skills-header:hover {
            background: rgba(91, 140, 255, 0.05);
        }

        .skills-header-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .skills-header-stats {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .section-content {
            display: block;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .section-content.collapsed {
            display: none;
        }

        .skills-header {
            cursor: pointer;
            user-select: none;
        }

        .skills-header .arrow-icon {
            transition: transform 0.2s ease;
            display: inline-block;
            font-size: 14px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 16px 0 12px 0;
        }

        .skill-tag {
            display: inline-block;
            padding: 8px 14px;
            margin: 6px 6px 6px 0;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 600;
        }

        .skill-matched {
            background: rgba(24, 199, 156, 0.15);
            border: 1px solid rgba(24, 199, 156, 0.3);
            color: var(--accent-success);
        }

        .skill-missing {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.4);
            color: #ff6b6b;
        }

        /* Course & Project Cards */
        .content-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 24px;
            margin-bottom: 20px;
        }

        .content-card h3, .content-card h4 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .course-card, .project-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 24px;
            margin-bottom: 20px;
        }

        .course-card h4, .project-card h4 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .course-detail, .project-detail {
            margin: 12px 0;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .course-detail strong, .project-detail strong {
            color: var(--text-primary);
            font-weight: 600;
            display: inline-block;
            min-width: 140px;
        }

        .course-description, .project-description {
            margin: 16px 0;
            padding: 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .content-card ul, .course-card ul, .project-card ul {
            margin: 8px 0;
            padding-left: 24px;
        }

        .content-card ul li, .course-card ul li, .project-card ul li {
            margin: 6px 0;
            color: var(--text-secondary);
        }

        /* Project Badge */
        .project-badge {
            display: inline-block;
            padding: 10px 18px;
            border-radius: 24px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .badge-current {
            background: #34D399;
            color: white;
            box-shadow: 0 4px 12px rgba(52, 211, 153, 0.3);
        }

        .badge-missing {
            background: #8B5CF6;
            color: white;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .project-card-item {
            border-left: 4px solid;
            padding-left: 20px;
        }

        .project-card-item.current {
            border-left-color: #34D399;
        }

        .project-card-item.missing {
            border-left-color: #8B5CF6;
        }

        /* Toggle Button */
        .toggle-section, .toggle-json {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .toggle-section:hover, .toggle-json:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(91, 140, 255, 0.3);
        }

        /* Cover Letter View */
        .cover-letter-view {
            background: var(--bg-tertiary);
            padding: 24px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            line-height: 1.8;
            color: var(--text-primary);
            margin-top: 16px;
        }

        .cover-letter-view p {
            margin-bottom: 15px;
        }

        .cover-letter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .cover-letter-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .copy-button {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .copy-button:hover {
            background: rgba(91, 140, 255, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .copy-button:active {
            transform: scale(0.98);
        }

        .copy-message {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(24, 199, 156, 0.9);
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .copy-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="brand">
                <div class="brand-logo">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="white" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 17L12 22L22 17" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 12L12 17L22 12" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="brand-text">skillbridge.AI</div>
            </div>
            <div class="nav-actions">
                <span class="badge">v1.0.0</span>
                <span class="badge">AI-Powered</span>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1 class="hero-title">AI-Powered Career Bridge</h1>
                <p class="hero-description">
                    Your AI-powered career companion for students and job seekers. Upload your résumé, analyze it against any job description, 
                    and instantly discover what skills you're missing. Get personalized course recommendations, hands-on project ideas, 
                    and AI-generated cover letters to land your internship/new grad job.
                </p>
                <div class="hero-features">
                    <div class="hero-feature" onclick="navigateToSection('resume-analysis')" style="cursor: pointer;">
                        <div class="hero-feature-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <!-- Document base -->
                                <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" fill="#ffffff"/>
                                <!-- Folded corner highlight -->
                                <path d="M14 2V8H20L14 2Z" fill="#e8e8e8"/>
                                <!-- Blue header section -->
                                <rect x="6" y="6" width="12" height="3" fill="#4a90e2" rx="0.5"/>
                                <!-- Text lines -->
                                <rect x="8" y="11" width="8" height="1.2" fill="#d0d0d0" rx="0.3"/>
                                <rect x="8" y="13" width="6" height="1.2" fill="#d0d0d0" rx="0.3"/>
                                <rect x="8" y="15" width="7" height="1.2" fill="#d0d0d0" rx="0.3"/>
                                <rect x="8" y="17" width="5" height="1.2" fill="#d0d0d0" rx="0.3"/>
                                <!-- Chart/graph element -->
                                <rect x="8" y="19" width="8" height="2" fill="#f0f0f0" rx="0.3"/>
                                <rect x="8.5" y="19.5" width="1.5" height="1" fill="#4a90e2"/>
                                <rect x="10.5" y="19.2" width="1.5" height="1.3" fill="#4a90e2"/>
                                <rect x="12.5" y="19.8" width="1.5" height="0.7" fill="#4a90e2"/>
                                <rect x="14.5" y="19.4" width="1.5" height="1.1" fill="#4a90e2"/>
                            </svg>
                        </div>
                        <h3 class="hero-feature-title">Resume Analysis</h3>
                    </div>
                    <div class="hero-feature" onclick="navigateToSection('learn-skills')" style="cursor: pointer;">
                        <div class="hero-feature-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <!-- Left page with shadow -->
                                <path d="M12 4.5H6C5.44772 4.5 5 4.94772 5 5.5V18.5C5 19.0523 5.44772 19.5 6 19.5H12V4.5Z" fill="#ffffff"/>
                                <path d="M12 4.5H6C5.44772 4.5 5 4.94772 5 5.5V18.5C5 19.0523 5.44772 19.5 6 19.5H12V4.5Z" fill="none" stroke="#e8e8e8" stroke-width="0.8"/>
                                <!-- Right page with shadow -->
                                <path d="M18.5 4.5H12V19.5H18.5C19.0523 19.5 19.5 19.0523 19.5 18.5V5.5C19.5 4.94772 19.0523 4.5 18.5 4.5Z" fill="#ffffff"/>
                                <path d="M18.5 4.5H12V19.5H18.5C19.0523 19.5 19.5 19.0523 19.5 18.5V5.5C19.5 4.94772 19.0523 4.5 18.5 4.5Z" fill="none" stroke="#e8e8e8" stroke-width="0.8"/>
                                <!-- Book binding/center crease with depth -->
                                <line x1="12" y1="4.5" x2="12" y2="19.5" stroke="#d0d0d0" stroke-width="1.2"/>
                                <line x1="11.5" y1="4.5" x2="11.5" y2="19.5" stroke="#c0c0c0" stroke-width="0.5" opacity="0.6"/>
                                <!-- Left page text lines (more visible) -->
                                <line x1="7" y1="7" x2="11" y2="7" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="7" y1="8.5" x2="10.5" y2="8.5" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="7" y1="10" x2="11" y2="10" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="7" y1="11.5" x2="9.5" y2="11.5" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="7" y1="13" x2="10" y2="13" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="7" y1="14.5" x2="11" y2="14.5" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="7" y1="16" x2="9" y2="16" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="7" y1="17.5" x2="10.5" y2="17.5" stroke="#c8c8c8" stroke-width="1"/>
                                <!-- Right page text lines (more visible) -->
                                <line x1="13" y1="7" x2="17.5" y2="7" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="13" y1="8.5" x2="16.5" y2="8.5" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="13" y1="10" x2="17.5" y2="10" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="13" y1="11.5" x2="15.5" y2="11.5" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="13" y1="13" x2="16" y2="13" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="13" y1="14.5" x2="17" y2="14.5" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="13" y1="16" x2="15" y2="16" stroke="#c8c8c8" stroke-width="1"/>
                                <line x1="13" y1="17.5" x2="16.5" y2="17.5" stroke="#c8c8c8" stroke-width="1"/>
                                <!-- Page corners for depth -->
                                <path d="M5 5.5L12 4.5L12 5.5L5 6.5Z" fill="#f5f5f5" opacity="0.8"/>
                                <path d="M19.5 5.5L12.5 4.5L12.5 5.5L19.5 6.5Z" fill="#f5f5f5" opacity="0.8"/>
                                <!-- Bottom page edges -->
                                <line x1="5" y1="18.5" x2="12" y2="19.5" stroke="#e0e0e0" stroke-width="0.8"/>
                                <line x1="12" y1="19.5" x2="19.5" y2="18.5" stroke="#e0e0e0" stroke-width="0.8"/>
                                <!-- Highlight on pages -->
                                <rect x="6" y="5.5" width="5" height="13" fill="none" stroke="#f8f8f8" stroke-width="0.5" opacity="0.4"/>
                                <rect x="13" y="5.5" width="5.5" height="13" fill="none" stroke="#f8f8f8" stroke-width="0.5" opacity="0.4"/>
                                <!-- Pen/Pencil - Blue pen with details -->
                                <!-- Pen body (blue) -->
                                <rect x="15.2" y="5.2" width="5" height="1.8" fill="#2563eb" rx="0.9" transform="rotate(45 17.7 6.1)"/>
                                <!-- Pen body highlight -->
                                <rect x="15.4" y="5.4" width="4.6" height="1.4" fill="#3b82f6" rx="0.7" transform="rotate(45 17.7 6.1)"/>
                                <!-- Pen body shadow -->
                                <rect x="15.5" y="5.5" width="4.2" height="1.2" fill="#1e40af" rx="0.6" transform="rotate(45 17.7 6.1)" opacity="0.4"/>
                                <!-- Pen tip (silver/metallic) -->
                                <path d="M19.2 9.2L20.8 10.8L19.5 10.5L19.2 9.2Z" fill="#cbd5e1"/>
                                <path d="M19.2 9.2L20.8 10.8L19.5 10.5L19.2 9.2Z" fill="#94a3b8" opacity="0.7"/>
                                <!-- Pen tip highlight -->
                                <path d="M19.3 9.3L20.5 10.5L19.4 10.3L19.3 9.3Z" fill="#e2e8f0"/>
                                <!-- Pen clip (silver) -->
                                <path d="M16 5.5L16.8 6.3L16.5 6.6L15.7 5.8Z" fill="#94a3b8"/>
                                <path d="M16 5.5L16.8 6.3L16.5 6.6L15.7 5.8Z" fill="#cbd5e1" opacity="0.6"/>
                                <!-- Pen clip detail -->
                                <line x1="16.2" y1="5.7" x2="16.6" y2="6.1" stroke="#64748b" stroke-width="0.3"/>
                                <!-- Pen grip section (darker blue) -->
                                <rect x="16.5" y="6.5" width="2.5" height="1.2" fill="#1e40af" rx="0.3" transform="rotate(45 17.75 7.1)"/>
                                <!-- Pen button/cap (red accent) -->
                                <circle cx="16.3" cy="5.9" r="0.4" fill="#ef4444"/>
                                <circle cx="16.3" cy="5.9" r="0.3" fill="#dc2626"/>
                            </svg>
                        </div>
                        <h3 class="hero-feature-title">Learn Skills</h3>
                    </div>
                    <div class="hero-feature" onclick="navigateToSection('build-projects')" style="cursor: pointer;">
                        <div class="hero-feature-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <!-- Laptop base -->
                                <rect x="4" y="15" width="16" height="3" fill="#ffffff" rx="0.5"/>
                                <rect x="4.5" y="15.5" width="15" height="2" fill="#e8e8e8" rx="0.3"/>
                                <!-- Laptop screen -->
                                <rect x="5" y="6" width="14" height="10" fill="#1e293b" rx="0.8"/>
                                <rect x="5.5" y="6.5" width="13" height="9" fill="#0f172a" rx="0.6"/>
                                <!-- Screen bezel -->
                                <rect x="5" y="6" width="14" height="10" fill="none" stroke="#ffffff" stroke-width="0.8" rx="0.8"/>
                                <!-- Screen inner border -->
                                <rect x="6" y="7.5" width="12" height="7" fill="none" stroke="#334155" stroke-width="0.5" rx="0.3"/>
                                
                                <!-- Code lines (visual representation without text) -->
                                <rect x="7" y="9" width="8" height="0.8" fill="#10b981" rx="0.2"/>
                                <rect x="7" y="10.5" width="3" height="0.8" fill="#ffffff" rx="0.2"/>
                                <rect x="7" y="12" width="6" height="0.8" fill="#f59e0b" rx="0.2"/>
                                <rect x="7" y="13.5" width="4" height="0.8" fill="#3b82f6" rx="0.2"/>
                                <rect x="7" y="15" width="5" height="0.8" fill="#ffffff" rx="0.2"/>
                                
                                <!-- Laptop hinge -->
                                <rect x="10" y="15" width="4" height="1" fill="#cbd5e1" rx="0.2"/>
                                <rect x="10.5" y="15.2" width="3" height="0.6" fill="#94a3b8" rx="0.1"/>
                                
                                <!-- Keyboard area (on base) -->
                                <rect x="6" y="16" width="12" height="1.5" fill="#cbd5e1" rx="0.2"/>
                                <!-- Keyboard keys -->
                                <rect x="6.5" y="16.3" width="1" height="0.8" fill="#94a3b8" rx="0.1"/>
                                <rect x="8" y="16.3" width="1" height="0.8" fill="#94a3b8" rx="0.1"/>
                                <rect x="9.5" y="16.3" width="1" height="0.8" fill="#94a3b8" rx="0.1"/>
                                <rect x="11" y="16.3" width="1" height="0.8" fill="#94a3b8" rx="0.1"/>
                                <rect x="12.5" y="16.3" width="1" height="0.8" fill="#94a3b8" rx="0.1"/>
                                <rect x="14" y="16.3" width="1" height="0.8" fill="#94a3b8" rx="0.1"/>
                                <rect x="15.5" y="16.3" width="1" height="0.8" fill="#94a3b8" rx="0.1"/>
                                
                                <!-- Screen glow/reflection -->
                                <rect x="5.5" y="6.5" width="13" height="2" fill="#ffffff" opacity="0.1" rx="0.6"/>
                            </svg>
                        </div>
                        <h3 class="hero-feature-title">Build Projects</h3>
                    </div>
                    <div class="hero-feature" onclick="navigateToSection('cover-letter')" style="cursor: pointer;">
                        <div class="hero-feature-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <!-- Document base (white paper) -->
                                <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" fill="#ffffff"/>
                                <!-- Folded corner -->
                                <path d="M14 2V8H20L14 2Z" fill="#f5f5f5"/>
                                <!-- Pink header section -->
                                <rect x="6" y="5" width="12" height="2.5" fill="#ec4899" rx="0.3"/>
                                <!-- Letter content lines -->
                                <rect x="8" y="9" width="8" height="1" fill="#c0c0c0" rx="0.2"/>
                                <rect x="8" y="10.8" width="7" height="1" fill="#c0c0c0" rx="0.2"/>
                                <rect x="8" y="12.6" width="8" height="1" fill="#c0c0c0" rx="0.2"/>
                                <rect x="8" y="14.4" width="6" height="1" fill="#c0c0c0" rx="0.2"/>
                                <rect x="8" y="16.2" width="7.5" height="1" fill="#c0c0c0" rx="0.2"/>
                                <!-- Signature line -->
                                <line x1="8" y1="18" x2="14" y2="18" stroke="#a855f7" stroke-width="1.2" stroke-linecap="round"/>
                                <path d="M13 17.5L14.5 18L13 18.5" stroke="#a855f7" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                                <!-- Decorative heart/stamp -->
                                <path d="M16 16C16 16.5 15.5 17 15 17C14.5 17 14 16.5 14 16C14 15.5 15 14.5 15 14.5C15 14.5 16 15.5 16 16Z" fill="#ec4899" opacity="0.6"/>
                            </svg>
                        </div>
                        <h3 class="hero-feature-title">Create Cover Letters</h3>
                    </div>
                </div>
            </div>
        </section>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('analyze', event)">Skill Gap Analyzer</button>
            <button class="tab-button" onclick="showTab('cover', event)">Cover Letter Generator</button>
        </div>
        
        <div id="analyze" class="tab-content active">
            {% include 'skill_analyzer.html' %}
        </div>
        
        <div id="cover" class="tab-content">
            {% include 'cover_letter.html' %}
        </div>
    </div>
    
    <script>
        function showTab(tabId, event) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabId).classList.add('active');
            
            // Add active class to clicked button
            if (event) {
                event.target.classList.add('active');
            } else {
                // Fallback: find button by tab ID
                document.querySelectorAll('.tab-button').forEach(button => {
                    if (button.textContent.includes(tabId === 'analyze' ? 'Skill Gap' : 'Cover Letter')) {
                        button.classList.add('active');
                    }
                });
            }
        }
        
        // State detection functions
        function hasAnalysisDone() {
            const resultArea = document.getElementById('analyzeResult');
            if (!resultArea || !resultArea.innerHTML) {
                return false;
            }
            // Check if result area contains metrics grid (analysis results)
            return resultArea.querySelector('.metrics-grid') !== null;
        }
        
        function isOnCoverLetterTab() {
            const coverTab = document.getElementById('cover');
            return coverTab && coverTab.classList.contains('active');
        }
        
        function hasCoverLetterGenerated() {
            const coverView = document.getElementById('coverLetterView');
            if (!coverView || !coverView.innerHTML) {
                return false;
            }
            // Check if cover letter view has generated content (not spinner/error/placeholder)
            const hasSpinner = coverView.querySelector('.spinner') !== null;
            const hasError = coverView.querySelector('.alert-error') !== null;
            const hasHeader = coverView.querySelector('.cover-letter-header') !== null;
            const hasPlaceholder = coverView.textContent.includes('Your generated cover letter will appear here');
            return !hasSpinner && !hasError && !hasPlaceholder && (hasHeader || coverView.innerHTML.trim().length > 100);
        }
        
        // Navigation function
        function navigateToSection(sectionName) {
            const isAnalysisDone = hasAnalysisDone();
            const isOnCoverTab = isOnCoverLetterTab();
            const isCoverLetterGenerated = hasCoverLetterGenerated();
            
            // Special case: Cover letter box always switches to cover letter tab when on analysis template
            if (sectionName === 'cover-letter' && !isOnCoverTab) {
                showTab('cover');
                return;
            }
            
            // Case a: No analysis done - all boxes link to analysis form
            if (!isAnalysisDone && !isOnCoverTab) {
                // Scroll to and focus the analysis form button
                const analyzeForm = document.getElementById('analyzeForm');
                if (analyzeForm) {
                    analyzeForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    // Focus the submit button
                    const submitBtn = analyzeForm.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        setTimeout(() => submitBtn.focus(), 300);
                    }
                }
                return;
            }
            
            // Case b: Analysis done (and not on cover tab) - navigate to specific sections
            if (isAnalysisDone && !isOnCoverTab) {
                switch(sectionName) {
                    case 'resume-analysis':
                        // Scroll to score section
                        const scoreSection = document.getElementById('score-section');
                        if (scoreSection) {
                            scoreSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                        break;
                    case 'learn-skills':
                        // Scroll to courses section
                        const coursesSection = document.getElementById('courses-section');
                        if (coursesSection) {
                            coursesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                        break;
                    case 'build-projects':
                        // Scroll to projects section
                        const projectsSection = document.getElementById('projects-section');
                        if (projectsSection) {
                            projectsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                        break;
                    case 'cover-letter':
                        // Switch to cover letter tab
                        showTab('cover');
                        break;
                }
                return;
            }
            
            // Case c: On cover letter tab, cover letter NOT generated
            if (isOnCoverTab && !isCoverLetterGenerated) {
                switch(sectionName) {
                    case 'resume-analysis':
                    case 'learn-skills':
                    case 'build-projects':
                        // Switch to analysis template
                        showTab('analyze');
                        break;
                    case 'cover-letter':
                        // Scroll to cover letter form button
                        const coverForm = document.getElementById('coverForm');
                        if (coverForm) {
                            coverForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            // Focus the submit button
                            const submitBtn = coverForm.querySelector('button[type="submit"]');
                            if (submitBtn) {
                                setTimeout(() => submitBtn.focus(), 300);
                            }
                        }
                        break;
                }
                return;
            }
            
            // Case d: On cover letter tab, cover letter generated
            if (isOnCoverTab && isCoverLetterGenerated) {
                switch(sectionName) {
                    case 'resume-analysis':
                    case 'learn-skills':
                    case 'build-projects':
                        // Switch to analysis template
                        showTab('analyze');
                        break;
                    case 'cover-letter':
                        // Scroll to cover letter content
                        const coverView = document.getElementById('coverLetterView');
                        if (coverView) {
                            coverView.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                        break;
                }
                return;
            }
        }
        
        // Function to render skill analyzer results
        function renderSkillAnalyzerResults(data) {
            let html = '';
            
            // Success message
            html += '<div class="alert alert-success" style="display: flex; align-items: center; gap: 10px;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> Analysis complete! Your comprehensive report is ready.</div>';
            
            // Grad student warning
            if (data.is_grad_student_job) {
                html += '<div class="alert alert-warning">';
                html += '<div class="alert-warning-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></svg></div>';
                html += '<div class="alert-warning-content">';
                html += '<strong>Graduate Student Position Detected</strong><br>';
                html += 'This job requires a Master\'s or PhD degree. You may not be qualified for this position based on education requirements. However, you may still take your shot if you want to apply.';
                html += '</div></div>';
            }
            
            // Metrics grid
            html += '<div class="metrics-grid" id="score-section">';
            html += '<div class="metric-card">';
            html += '<div class="metric-label">Overall Match</div>';
            html += '<div class="metric-value">' + data.overall_score.weighted_score.toFixed(1) + '%</div>';
            html += '</div>';
            html += '<div class="metric-card">';
            html += '<div class="metric-label">Required Coverage</div>';
            html += '<div class="metric-value">' + data.required_skills.match_score.toFixed(1) + '%</div>';
            html += '</div>';
            html += '<div class="metric-card">';
            html += '<div class="metric-label">Preferred Coverage</div>';
            html += '<div class="metric-value">' + data.preferred_skills.match_score.toFixed(1) + '%</div>';
            html += '</div>';
            html += '</div>';
            
            // Required Skills
            html += '<div class="skills-section">';
            html += '<div class="skills-header collapsed" id="required-skills-header" onclick="toggleSkillsSection(\'required-skills\')">';
            html += '<div style="display: flex; align-items: center; gap: 10px;">';
            html += '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z"></path><path d="M14 2V8H20"></path><path d="M16 13H8"></path><path d="M16 17H8"></path><path d="M10 9H9H8"></path></svg>';
            html += '<div><div class="skills-header-title">Required Skills Coverage</div>';
            html += '<div class="skills-header-stats">' + data.required_skills.covered_count + ' of ' + data.required_skills.total_count + ' skills matched</div></div>';
            html += '</div>';
            html += '<div class="arrow-icon" style="color: var(--accent-primary);">►</div>';
            html += '</div>';
            html += '<div id="required-skills" class="section-content collapsed">';
            if (data.required_skills.covered_skills && data.required_skills.covered_skills.length > 0) {
                html += '<div class="section-title" style="display: flex; align-items: center; gap: 8px;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent-success)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> Matched Skills (' + data.required_skills.covered_skills.length + ')</div>';
                data.required_skills.covered_skills.forEach(skill => {
                    html += '<span class="skill-tag skill-matched">' + escapeHtml(skill) + '</span>';
                });
            } else {
                html += '<div class="section-title">No matched skills</div>';
            }
            if (data.required_skills.missing_skills && data.required_skills.missing_skills.length > 0) {
                html += '<div class="section-title" style="margin-top: 20px; display: flex; align-items: center; gap: 8px;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent-error)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> Missing Skills (' + data.required_skills.missing_skills.length + ')</div>';
                data.required_skills.missing_skills.forEach(skill => {
                    html += '<span class="skill-tag skill-missing">' + escapeHtml(skill) + '</span>';
                });
            } else {
                html += '<div class="section-title" style="margin-top: 20px; display: flex; align-items: center; gap: 8px;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent-success)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> All required skills covered!</div>';
            }
            html += '</div>';
            html += '</div>';
            
            // Preferred Skills
            html += '<div class="skills-section">';
            html += '<div class="skills-header collapsed" id="preferred-skills-header" onclick="toggleSkillsSection(\'preferred-skills\')">';
            html += '<div style="display: flex; align-items: center; gap: 10px;">';
            html += '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-warning)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>';
            html += '<div><div class="skills-header-title">Preferred Skills Coverage</div>';
            html += '<div class="skills-header-stats">' + data.preferred_skills.covered_count + ' of ' + data.preferred_skills.total_count + ' skills matched</div></div>';
            html += '</div>';
            html += '<div class="arrow-icon" style="color: var(--accent-primary);">►</div>';
            html += '</div>';
            html += '<div id="preferred-skills" class="section-content collapsed">';
            if (data.preferred_skills.covered_skills && data.preferred_skills.covered_skills.length > 0) {
                html += '<div class="section-title" style="display: flex; align-items: center; gap: 8px;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent-success)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> Matched Skills (' + data.preferred_skills.covered_skills.length + ')</div>';
                data.preferred_skills.covered_skills.forEach(skill => {
                    html += '<span class="skill-tag skill-matched">' + escapeHtml(skill) + '</span>';
                });
            } else {
                html += '<div class="section-title">No matched skills</div>';
            }
            if (data.preferred_skills.missing_skills && data.preferred_skills.missing_skills.length > 0) {
                html += '<div class="section-title" style="margin-top: 20px; display: flex; align-items: center; gap: 8px;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent-error)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> Missing Skills (' + data.preferred_skills.missing_skills.length + ')</div>';
                data.preferred_skills.missing_skills.forEach(skill => {
                    html += '<span class="skill-tag skill-missing">' + escapeHtml(skill) + '</span>';
                });
            } else {
                html += '<div class="section-title" style="margin-top: 20px; display: flex; align-items: center; gap: 8px;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent-success)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> All preferred skills covered!</div>';
            }
            html += '</div>';
            html += '</div>';
            
            // Course Recommendations
            if (data.course_recommendations) {
                html += '<div class="content-card" id="courses-section">';
                html += '<h4 style="display: flex; align-items: center; gap: 10px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6.25278V19.2528M12 6.25278C10.8321 5.47686 9.24649 5 7.5 5C5.75351 5 4.16789 5.47686 3 6.25278V19.2528C4.16789 18.4769 5.75351 18 7.5 18C9.24649 18 10.8321 18.4769 12 19.2528M12 6.25278C13.1679 5.47686 14.7535 5 16.5 5C18.2465 5 19.8321 5.47686 21 6.25278V19.2528C19.8321 18.4769 18.2465 18 16.5 18C14.7535 18 13.1679 18.4769 12 19.2528"></path></svg> Course Recommendations</h4>';
                
                // Combine free and paid courses, label them appropriately
                const allCourses = [];
                
                // Add first free course with "Free Course" label (green badge)
                if (data.course_recommendations.free_courses && data.course_recommendations.free_courses.length > 0) {
                    allCourses.push({
                        ...data.course_recommendations.free_courses[0],
                        label: 'Free Course',
                        badgeClass: 'badge-current'
                    });
                }
                
                // Add first paid course with "Paid Course" label (purple badge)
                if (data.course_recommendations.paid_courses && data.course_recommendations.paid_courses.length > 0) {
                    allCourses.push({
                        ...data.course_recommendations.paid_courses[0],
                        label: 'Paid Course',
                        badgeClass: 'badge-missing'
                    });
                }
                
                // Render courses in project-style cards
                allCourses.forEach((course, idx) => {
                    html += '<div style="margin-bottom: 24px;">';
                    html += '<span class="project-badge ' + course.badgeClass + '">+ ' + course.label.toUpperCase() + '</span>';
                    // Add border color class based on course type
                    const borderClass = course.label === 'Free Course' ? 'current' : 'missing';
                    html += '<div class="course-card project-card-item ' + borderClass + '">';
                    html += '<h4>' + escapeHtml(course.title || 'Untitled Course') + '</h4>';
                    html += '<div class="project-detail"><strong>Platform:</strong> ' + escapeHtml(course.platform || 'N/A') + '</div>';
                    html += '<div class="project-detail"><strong>Duration:</strong> ' + escapeHtml(course.duration || 'N/A') + '</div>';
                    html += '<div class="project-detail"><strong>Difficulty:</strong> ' + escapeHtml(course.difficulty || 'N/A') + '</div>';
                    html += '<div class="project-detail"><strong>Cost:</strong> ' + escapeHtml(course.cost || (course.label === 'Free Course' ? 'Free' : 'N/A')) + '</div>';
                    
                    if (course.description) {
                        html += '<div class="project-description"><strong>Description:</strong><br>' + escapeHtml(course.description) + '</div>';
                    }
                    
                    if (course.skills_covered && course.skills_covered.length > 0) {
                        html += '<div class="project-detail"><strong>Skills Covered:</strong> ';
                        course.skills_covered.forEach((skill, skillIdx) => {
                            html += '<span class="skill-tag skill-matched">' + escapeHtml(skill) + '</span>';
                        });
                        html += '</div>';
                    }
                    
                    if (course.additional_skills && course.additional_skills.length > 0) {
                        html += '<div class="project-detail"><strong>Additional Skills:</strong> ' + course.additional_skills.map(s => escapeHtml(s)).join(', ') + '</div>';
                    }
                    
                    if (course.link) {
                        html += '<div class="project-detail"><strong>Link:</strong> <a href="' + escapeHtml(course.link) + '" target="_blank" style="color: var(--accent-primary); text-decoration: none;">' + escapeHtml(course.link) + '</a></div>';
                    }
                    
                    if (course.why_efficient) {
                        html += '<div class="project-detail"><strong>Why This Course:</strong> ' + escapeHtml(course.why_efficient) + '</div>';
                    }
                    
                    html += '</div>';
                    html += '</div>';
                });
                
                html += '</div>';
            }
            
            // Project Recommendations
            if (data.project_recommendations && Object.keys(data.project_recommendations).length > 0) {
                html += '<div class="content-card" id="projects-section">';
                html += '<h4 style="display: flex; align-items: center; gap: 10px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7L12 12L22 7L12 2Z"></path><path d="M2 17L12 22L22 17"></path><path d="M2 12L12 17L22 12"></path></svg> Project Recommendations</h4>';
                
                Object.entries(data.project_recommendations).forEach(([track, projects]) => {
                    html += '<div style="margin-bottom: 20px;">';
                    html += '<h4 style="color: var(--accent-primary); font-weight: 600; margin-bottom: 15px;">Track: ' + escapeHtml(track) + '</h4>';
                    
                    projects.forEach((project, idx) => {
                        const isCurrentSkills = idx === 0;
                        const badgeText = isCurrentSkills ? 'Build with Your Current Skills' : 'Learn Missing Skills & Fill the Gap';
                        const badgeClass = isCurrentSkills ? 'badge-current' : 'badge-missing';
                        const cardClass = isCurrentSkills ? 'current' : 'missing';
                        
                        // Generate unique ID for this project's outline
                        const projectId = 'project-' + track.replace(/[^a-zA-Z0-9]/g, '-') + '-' + idx;
                        
                        html += '<div style="margin-bottom: 24px;">';
                        html += '<span class="project-badge ' + badgeClass + '">' + badgeText + '</span>';
                        html += '<div class="course-card project-card-item ' + cardClass + '">';
                        html += '<h4>' + escapeHtml(project.title || 'Untitled Project') + '</h4>';
                        
                        if (project.description) {
                            html += '<div class="project-description"><strong>Description:</strong><br>' + escapeHtml(project.description) + '</div>';
                        }
                        
                        if (project.tech_stack && project.tech_stack.length > 0) {
                            html += '<div class="project-detail"><strong>Tech Stack:</strong><ul>';
                            project.tech_stack.forEach(tech => {
                                html += '<li>' + escapeHtml(tech) + '</li>';
                            });
                            html += '</ul></div>';
                        }
                        
                        
                        if (project.technologies && project.technologies.length > 0) {
                            html += '<div class="project-detail"><strong>Technologies:</strong> ' + project.technologies.map(t => escapeHtml(t)).join(', ') + '</div>';
                        }
                        
                        if (project.implementation_phases && project.implementation_phases.length > 0) {
                            html += '<div class="project-detail">';
                            html += '<strong>Implementation Phases:</strong>';
                            html += '<div style="margin-top: 12px;">';
                            project.implementation_phases.forEach((phase, phaseIdx) => {
                                const phaseName = typeof phase === 'object' ? phase.phase : phase;
                                const phaseOutline = typeof phase === 'object' ? (phase.outline || phase.details || '') : '';
                                html += '<div style="margin-bottom: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 6px; border-left: 3px solid var(--accent-primary);">';
                                html += '<strong style="color: var(--accent-primary); display: block; margin-bottom: 6px;">' + escapeHtml(phaseName || 'Phase ' + (phaseIdx + 1)) + '</strong>';
                                if (phaseOutline) {
                                    html += '<div style="color: var(--text-secondary); line-height: 1.6;">' + escapeHtml(phaseOutline) + '</div>';
                                }
                                html += '</div>';
                            });
                            html += '</div>';
                            html += '</div>';
                        }
                        
                        
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    });
                    
                    html += '</div>';
                });
                
                html += '</div>';
            }
            
            // Add download button
            html += '<button class="toggle-section" onclick="downloadAnalysisReport()" style="margin-top: 24px; display: flex; align-items: center; gap: 8px; justify-content: center;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg> Download Full Report</button>';
            
            return html;
        }
        
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return String(text).replace(/[&<>"']/g, m => map[m]);
        }
        
        function toggleProjectPhases(projectId) {
            const phasesDiv = document.getElementById(projectId + '-phases');
            const outlineSpan = document.getElementById(projectId + '-outline');
            const arrowSpan = document.getElementById(projectId + '-arrow');
            if (phasesDiv) {
                if (phasesDiv.style.display === 'none') {
                    phasesDiv.style.display = 'block';
                    if (arrowSpan) {
                        arrowSpan.style.transform = 'rotate(90deg)';
                        arrowSpan.textContent = '▼';
                    }
                    if (outlineSpan) {
                        outlineSpan.style.fontWeight = '600';
                    }
                } else {
                    phasesDiv.style.display = 'none';
                    if (arrowSpan) {
                        arrowSpan.style.transform = 'rotate(0deg)';
                        arrowSpan.textContent = '▶';
                    }
                    if (outlineSpan) {
                        outlineSpan.style.fontWeight = 'normal';
                    }
                }
            }
        }
        
        function toggleSkillsSection(id) {
            const section = document.getElementById(id);
            const header = document.getElementById(id + '-header');
            if (section) {
                const isCollapsed = section.classList.contains('collapsed');
                section.classList.toggle('collapsed');
                if (header) {
                    header.classList.toggle('collapsed');
                    // Update arrow icon
                    const arrowIcon = header.querySelector('.arrow-icon');
                    if (arrowIcon) {
                        arrowIcon.textContent = isCollapsed ? '▼' : '►';
                    }
                }
            }
        }
        
        function downloadAnalysisReport() {
            // Get the result area content
            const resultArea = document.getElementById('analyzeResult');
            if (!resultArea) {
                alert('No analysis results to download.');
                return;
            }
            
            // Clone the result content
            const content = resultArea.cloneNode(true);
            
            // Remove the download button from the clone
            const downloadBtn = content.querySelector('button');
            if (downloadBtn) {
                downloadBtn.remove();
            }
            
            // Expand all collapsed sections in the clone
            const collapsedSections = content.querySelectorAll('.section-content.collapsed');
            collapsedSections.forEach(section => {
                section.classList.remove('collapsed');
            });
            
            // Update arrow icons to show expanded state
            const headers = content.querySelectorAll('.skills-header');
            headers.forEach(header => {
                header.classList.remove('collapsed');
                const arrowIcon = header.querySelector('.arrow-icon');
                if (arrowIcon) {
                    arrowIcon.textContent = '▼';
                }
            });
            
            // Create a comprehensive HTML document
            const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill Gap Analysis Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Inter', 'Helvetica Neue', Arial, sans-serif;
            background: #0a0e27;
            color: #e7ecff;
            padding: 40px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #5b8cff 0%, #7c4dff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .report-date {
            color: #a6b0cf;
            margin-bottom: 30px;
        }
        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid;
        }
        .alert-success {
            background: rgba(24, 199, 156, 0.15);
            border-color: rgba(24, 199, 156, 0.3);
            color: #18c79c;
        }
        .alert-warning {
            background: rgba(255, 176, 32, 0.15);
            border-color: rgba(255, 176, 32, 0.3);
            color: #ffb020;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        .metric-card {
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid rgba(91, 140, 255, 0.15);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
        }
        .metric-label {
            font-size: 14px;
            color: #a6b0cf;
            margin-bottom: 8px;
        }
        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: #5b8cff;
        }
        .content-card {
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid rgba(91, 140, 255, 0.15);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        .content-card h4 {
            font-size: 20px;
            font-weight: 700;
            color: #e7ecff;
            margin-bottom: 20px;
        }
        .skill-tag {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            margin: 4px;
        }
        .skill-matched {
            background: rgba(24, 199, 156, 0.15);
            border: 1px solid rgba(24, 199, 156, 0.3);
            color: #18c79c;
        }
        .skill-missing {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.4);
            color: #ff6b6b;
        }
        .project-badge {
            display: inline-block;
            padding: 10px 18px;
            border-radius: 24px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
            color: white;
        }
        .badge-current {
            background: #34D399;
        }
        .badge-missing {
            background: #8B5CF6;
        }
        .course-card, .project-card {
            background: #13182e;
            border: 1px solid rgba(91, 140, 255, 0.15);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }
        .project-card-item.current {
            border-left-color: #34D399;
        }
        .project-card-item.missing {
            border-left-color: #8B5CF6;
        }
        .project-detail, .course-detail {
            margin: 12px 0;
            font-size: 14px;
            color: #a6b0cf;
        }
        .project-description {
            margin: 16px 0;
            color: #a6b0cf;
            line-height: 1.6;
        }
        ul {
            margin: 8px 0;
            padding-left: 24px;
        }
        li {
            margin: 6px 0;
            color: #a6b0cf;
        }
        .skills-section {
            margin-bottom: 24px;
        }
        .skills-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: rgba(26, 31, 58, 0.4);
            border: 1px solid rgba(91, 140, 255, 0.15);
            border-radius: 8px;
            margin-bottom: 12px;
            cursor: pointer;
        }
        .section-content {
            display: block;
            margin-top: 16px;
            padding-top: 16px;
        }
        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: #a6b0cf;
            margin-bottom: 12px;
            margin-top: 16px;
        }
        @media print {
            body {
                background: white;
                color: black;
            }
            .content-card, .metric-card, .course-card, .project-card {
                background: #f5f5f5;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Skill Gap Analysis Report</h1>
        <div class="report-date">Generated: ${new Date().toLocaleString()}</div>
        ${content.innerHTML}
    </div>
</body>
</html>`;
            
            // Create blob and download
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `skill-gap-analysis-report-${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Skill Analyzer form handler with automatic fallback to sync endpoint
        document.getElementById('analyzeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            const resumeFile = document.getElementById('analyzeResume').files[0];
            const jobText = document.getElementById('analyzeJobText').value;
            
            if (!resumeFile || !jobText) {
                alert('Please upload a resume and provide a job description.');
                return;
            }
            
            formData.append('resume', resumeFile);
            formData.append('job_text', jobText);
            
            const submitBtn = document.querySelector('#analyzeForm button[type="submit"]');
            const resultArea = document.getElementById('analyzeResult');
            
            submitBtn.disabled = true;
            
            // Initialize simple progress display - single line with spinner (minimal spacing)
            resultArea.innerHTML = '<div style="padding: 0; display: flex; align-items: center; justify-content: space-between; gap: 12px;"><div style="display: flex; align-items: center; gap: 12px;"><div class="spinner" style="border: 2px solid var(--border-color); border-top: 2px solid var(--accent-primary); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite;"></div><span id="progressText" style="color: var(--text-secondary); font-size: 14px;">Processing...</span></div><span id="countdownTimer" style="color: var(--text-secondary); font-size: 14px; font-weight: 500; min-width: 50px; text-align: right;"></span></div>';
            const progressText = document.getElementById('progressText');
            const countdownTimer = document.getElementById('countdownTimer');
            
            // Start countdown timer (60 seconds / 1 minute)
            let countdown = 60;
            let countdownInterval = null;
            const updateCountdown = () => {
                if (countdownTimer) {
                    if (countdown <= 0) {
                        if (countdownInterval) {
                            clearInterval(countdownInterval);
                            countdownInterval = null;
                        }
                        countdownTimer.textContent = 'processing in few seconds';
                    } else {
                        countdownTimer.textContent = `${countdown}s`;
                        countdown--;
                    }
                }
            };
            if (countdownTimer) {
                updateCountdown();
                countdownInterval = setInterval(updateCountdown, 1000);
            }
            
            try {
                // Use streaming endpoint
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ detail: `Server error: ${response.status}` }));
                    throw new Error(errorData.detail || `Server error: ${response.status}`);
                }
                
                // Check if response is actually a stream
                if (!response.body) {
                    throw new Error('Server did not return a valid response stream');
                }
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                let finalData = null;
                let streamError = null;
                let timeoutId = null;
                
                // Set a timeout for the stream (120 seconds / 2 minutes)
                const streamTimeout = new Promise((_, reject) => {
                    timeoutId = setTimeout(() => {
                        reject(new Error('Stream timeout'));
                    }, 120000);
                });
                
                try {
                    const readStream = async () => {
                        while (true) {
                            const { done, value } = await reader.read();
                            if (done) break;
                            
                            buffer += decoder.decode(value, { stream: true });
                            const lines = buffer.split('\n');
                            buffer = lines.pop() || '';
                            
                            for (const line of lines) {
                                if (line.trim() === '') continue;
                                
                                if (line.startsWith('data: ')) {
                                    try {
                                        const jsonStr = line.slice(6).trim();
                                        if (!jsonStr) continue;
                                        
                                        const data = JSON.parse(jsonStr);
                                        
                                        if (data.type === 'progress') {
                                            if (progressText) {
                                                let message = data.message;
                                                message = message.replace(/^Step \d+:\s*/i, '');
                                                progressText.textContent = message;
                                            }
                                        } else if (data.type === 'complete') {
                                            finalData = data.data;
                                        } else if (data.type === 'error') {
                                            streamError = new Error(data.message);
                                        }
                                    } catch (e) {
                                        console.error('Error parsing SSE data:', e, 'Line:', line);
                                    }
                                }
                            }
                        }
                    };
                    
                    await Promise.race([readStream(), streamTimeout]);
                    
                    if (timeoutId) clearTimeout(timeoutId);
                    
                    if (streamError) {
                        throw streamError;
                    }
                    
                    if (finalData) {
                        resultArea.innerHTML = renderSkillAnalyzerResults(finalData);
                    } else {
                        // No data from stream
                        throw new Error('No data received from server. Please try again.');
                    }
                } catch (streamErr) {
                    if (timeoutId) clearTimeout(timeoutId);
                    throw streamErr;
                }
            } catch (error) {
                console.error('Request error:', error);
                resultArea.innerHTML = '<div class="alert alert-error" style="display: flex; align-items: center; gap: 10px;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> Error: ' + escapeHtml(error.message) + '</div>';
            } finally {
                // Clear countdown timer
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                    countdownInterval = null;
                }
                submitBtn.disabled = false;
            }
        });
        
        // Cover Letter form handler
        document.getElementById('coverForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            const resumeFile = document.getElementById('coverResume').files[0];
            const jobText = document.getElementById('coverJobText').value;
            const templateFile = document.getElementById('coverTemplate').files[0];
            
            if (!resumeFile || !jobText) {
                alert('Please upload a resume and provide a job description.');
                return;
            }
            
            formData.append('resume', resumeFile);
            formData.append('job_text', jobText);
            if (templateFile) {
                formData.append('template', templateFile);
            }
            
            const submitBtn = document.querySelector('#coverForm button[type="submit"]');
            const coverView = document.getElementById('coverLetterView');
            
            submitBtn.disabled = true;
            
            // Clear previous cover letter text
            currentCoverLetterText = '';
            
            // Initialize simple progress display - single line with spinner (minimal spacing)
            coverView.innerHTML = '<div style="padding: 0; display: flex; align-items: center; justify-content: space-between; gap: 12px;"><div style="display: flex; align-items: center; gap: 12px;"><div class="spinner" style="border: 2px solid var(--border-color); border-top: 2px solid var(--accent-primary); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite;"></div><span id="coverProgressText" style="color: var(--text-secondary); font-size: 14px;">Processing...</span></div><span id="coverCountdownTimer" style="color: var(--text-secondary); font-size: 14px; font-weight: 500; min-width: 50px; text-align: right;"></span></div>';
            const progressText = document.getElementById('coverProgressText');
            const countdownTimer = document.getElementById('coverCountdownTimer');
            
            // Start countdown timer (60 seconds / 1 minute)
            let countdown = 60;
            let countdownInterval = null;
            const updateCountdown = () => {
                if (countdownTimer) {
                    if (countdown <= 0) {
                        if (countdownInterval) {
                            clearInterval(countdownInterval);
                            countdownInterval = null;
                        }
                        countdownTimer.textContent = 'processing in few seconds';
                    } else {
                        countdownTimer.textContent = `${countdown}s`;
                        countdown--;
                    }
                }
            };
            if (countdownTimer) {
                updateCountdown();
                countdownInterval = setInterval(updateCountdown, 1000);
            }
            
            // Helper function to render cover letter
            const renderCoverLetter = (finalData) => {
                const letterText = finalData.cover_letter || '';
                const lines = letterText.split('\n');
                
                // Extract first line (name) and rest of the content
                const firstName = lines[0]?.trim() || '';
                const restOfContent = lines.slice(1).join('\n');
                
                // Split remaining content into paragraphs
                const paragraphs = restOfContent.split(/\n{2,}/).map(p => {
                    const para = p.replace(/\n/g, '<br>');
                    return `<p>${para}</p>`;
                }).join('');
                
                // Create header with name and copy button
                const headerHtml = `
                    <div class="cover-letter-header">
                        <div class="cover-letter-name">${escapeHtml(firstName)}</div>
                        <button class="copy-button" onclick="copyCoverLetter()" title="Copy cover letter">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy
                        </button>
                    </div>
                `;
                
                coverView.innerHTML = headerHtml + paragraphs;
                currentCoverLetterText = letterText;
            };
            
            try {
                // Use streaming endpoint
                const response = await fetch('/cover-letter', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ detail: `Server error: ${response.status}` }));
                    throw new Error(errorData.detail || `Server error: ${response.status}`);
                }
                
                // Check if response is actually a stream
                if (!response.body) {
                    throw new Error('Server did not return a valid response stream');
                }
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                let finalData = null;
                let streamError = null;
                let timeoutId = null;
                
                // Set a timeout for the stream (120 seconds / 2 minutes)
                const streamTimeout = new Promise((_, reject) => {
                    timeoutId = setTimeout(() => {
                        reject(new Error('Stream timeout'));
                    }, 120000);
                });
                
                try {
                    const readStream = async () => {
                        while (true) {
                            const { done, value } = await reader.read();
                            if (done) break;
                            
                            buffer += decoder.decode(value, { stream: true });
                            const lines = buffer.split('\n');
                            buffer = lines.pop() || '';
                            
                            for (const line of lines) {
                                if (line.trim() === '') continue;
                                
                                if (line.startsWith('data: ')) {
                                    try {
                                        const jsonStr = line.slice(6).trim();
                                        if (!jsonStr) continue;
                                        
                                        const data = JSON.parse(jsonStr);
                                        
                                        if (data.type === 'progress') {
                                            if (progressText) {
                                                let message = data.message;
                                                message = message.replace(/^Step \d+:\s*/i, '');
                                                progressText.textContent = message;
                                            }
                                        } else if (data.type === 'complete') {
                                            finalData = data.data;
                                        } else if (data.type === 'error') {
                                            streamError = new Error(data.message);
                                        }
                                    } catch (e) {
                                        console.error('Error parsing SSE data:', e, 'Line:', line);
                                    }
                                }
                            }
                        }
                    };
                    
                    await Promise.race([readStream(), streamTimeout]);
                    
                    if (timeoutId) clearTimeout(timeoutId);
                    
                    if (streamError) {
                        throw streamError;
                    }
                    
                    if (finalData) {
                        renderCoverLetter(finalData);
                    } else {
                        // No data from stream
                        throw new Error('No data received from server. Please try again.');
                    }
                } catch (streamErr) {
                    if (timeoutId) clearTimeout(timeoutId);
                    throw streamErr;
                }
            } catch (error) {
                console.error('Request error:', error);
                coverView.innerHTML = '<div class="alert alert-error" style="display: flex; align-items: center; gap: 10px;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> Error: ' + escapeHtml(error.message) + '</div>';
            } finally {
                // Clear countdown timer
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                    countdownInterval = null;
                }
                submitBtn.disabled = false;
            }
        });
        
        // Store cover letter text globally for copying
        let currentCoverLetterText = '';
        
        // Copy cover letter function
        function copyCoverLetter() {
            if (!currentCoverLetterText) {
                return;
            }
            
            // Copy to clipboard
            navigator.clipboard.writeText(currentCoverLetterText).then(() => {
                // Show "copied" message
                showCopyMessage();
            }).catch(err => {
                console.error('Failed to copy:', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = currentCoverLetterText;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showCopyMessage();
                } catch (e) {
                    console.error('Fallback copy failed:', e);
                }
                document.body.removeChild(textArea);
            });
        }
        
        function showCopyMessage() {
            // Remove existing message if any
            const existingMsg = document.querySelector('.copy-message');
            if (existingMsg) {
                existingMsg.remove();
            }
            
            // Create and show message
            const message = document.createElement('div');
            message.className = 'copy-message';
            message.textContent = 'Copied!';
            document.body.appendChild(message);
            
            // Trigger animation
            setTimeout(() => {
                message.classList.add('show');
            }, 10);
            
            // Hide after 2 seconds
            setTimeout(() => {
                message.classList.remove('show');
                setTimeout(() => {
                    message.remove();
                }, 300);
            }, 2000);
        }
    </script>
</body>
</html>

